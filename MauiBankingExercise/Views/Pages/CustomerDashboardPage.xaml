<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:controls="clr-namespace:MauiBankingExercise.Views.Controls"
             x:Class="MauiBankingExercise.Views.Pages.CustomerDashboardPage"
             Title="{Binding Customer.FullName}"
             BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#1E1E1E}">

    <RefreshView IsRefreshing="{Binding IsBusy}" 
                 Command="{Binding RefreshCommand}">
        <ScrollView>
            <StackLayout Padding="0,8">
                <!-- Welcome Header -->
                <StackLayout Padding="20,16,20,8">
                    <Label Text="{Binding Customer.FullName, StringFormat='Welcome, {0}'}" 
                           FontSize="24" 
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                    <Label Text="{Binding Customer.Email}" 
                           FontSize="16" 
                           TextColor="{AppThemeBinding Light=#666666, Dark=#CCCCCC}"
                           Margin="0,4,0,0" />
                </StackLayout>

                <!-- Total Balance Card -->
                <controls:BalanceCard Title="Total Balance"
                                     Balance="{Binding TotalBalance}"
                                     Subtitle="Across all accounts" />

                <!-- Accounts Section -->
                <StackLayout Padding="20,16,20,8">
                    <Label Text="Your Accounts" 
                           FontSize="20" 
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light=Black, Dark=White}" />
                </StackLayout>

                <!-- Accounts List -->
                <CollectionView ItemsSource="{Binding Accounts}"
                               SelectionMode="Single"
                               Margin="8,0,8,16">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Grid>
                                <controls:AccountCard Account="{Binding}" />
                                <Grid.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.SelectAccountCommand}"
                                                         CommandParameter="{Binding}" />
                                </Grid.GestureRecognizers>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <!-- Empty State -->
                <StackLayout IsVisible="{Binding Accounts.Count, Converter={StaticResource IntToBoolConverter}}"
                            Padding="40"
                            VerticalOptions="CenterAndExpand">
                    <Label Text="No accounts found" 
                           FontSize="18" 
                           TextColor="{AppThemeBinding Light=#666666, Dark=#CCCCCC}"
                           HorizontalOptions="Center" />
                    <Label Text="Contact your bank to open an account" 
                           FontSize="14" 
                           TextColor="{AppThemeBinding Light=#999999, Dark=#999999}"
                           HorizontalOptions="Center"
                           Margin="0,8,0,0" />
                </StackLayout>
            </StackLayout>
        </ScrollView>
    </RefreshView>
</ContentPage>